@model ReadySetResource.ViewModels.RotaViewModel
@{
    ViewBag.Title = "Rota";
    Layout = "~/Views/Shared/_DashLayout.cshtml";
}

<h2>Rota - For Week @Model.ActiveWeekCommenceDate.Day/@Model.ActiveWeekCommenceDate.Month to @Model.ActiveWeekCommenceDate.AddDays(6).Day/@Model.ActiveWeekCommenceDate.AddDays(6).Month </h2>

@if (Model.Employees.Count() == 0)
{
    <text>You have no employees!</text>
}
else if (Model.Shifts.Count() == 0)
{
    <text>You have no shifts for this week!</text>
}
else
{
    <style>
        #rota {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            text-align: center;
            border-collapse: collapse;
            width: 100%;
        }

            #rota td, #customers th {
                border: 1px solid #ddd;
                padding: 6px;
                width: 1%;
            }

            #rota tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            #rota tr:hover {
                background-color: #ddd;
            }

            #rota th {
                padding-top: 12px;
                padding-bottom: 12px;
                text-align: center;
                background-color: #428bca;
                color: white;
            }
    </style>
    <table id="rota">
        <thead>
            <tr>
                <th rowspan="2">Employee</th>
                <th colspan="2">Monday</th>
                <th colspan="2">Tuesday</th>
                <th colspan="2">Wednesday</th>
                <th colspan="2">Thursday</th>
                <th colspan="2">Friday</th>
                <th colspan="2">Saturday</th>
                <th colspan="2">Sunday</th>
            </tr>
            <tr>
                <th>Start</th>
                <th>End</th>
                <th>Start</th>
                <th>End</th>
                <th>Start</th>
                <th>End</th>
                <th>Start</th>
                <th>End</th>
                <th>Start</th>
                <th>End</th>
                <th>Start</th>
                <th>End</th>
                <th>Start</th>
                <th>End</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var employee in Model.Employees)
            {
                <tr>
                    <td align="left" style="table-layout:fixed;">@employee.FirstName @employee.LastName</td>

                    @{
                        var empShifts = Model.Shifts;
                        int currEmpIndex = Model.Employees.IndexOf(employee);
                        int prevEmpIndex = Model.Employees.IndexOf(employee) - 1;
                        int currMinElement = (prevEmpIndex * 7) + 7;
                        empShifts = Model.Shifts.ToList().GetRange(currMinElement, 7);
                    }

                    @foreach (var empShift in empShifts)
                    {
                        if (empShift == null)
                        {
                            <td></td>
                            <td></td>
                        }
                        else if (empShift.UserId == employee.Id)
                        {
                            <td>
                                @empShift.StartDateTime.Hour :
                                @if (empShift.StartDateTime.Minute < 10)
                                {<text>0</text>@empShift.StartDateTime.Minute }
                            else
                            { @empShift.StartDateTime.Minute}
                            </td>
                            <td>
                                @empShift.EndDateTime.Hour :
                                @if (empShift.EndDateTime.Minute < 10)
                                {<text>0</text>@empShift.EndDateTime.Minute }
                            else
                            { @empShift.EndDateTime.Minute}
                            </td>
                        }
                    }

                </tr>
            }
        </tbody>

    </table>
}


    <footer style="text-align:center; align-content:center; padding-top:20px">
        @Html.ActionLink("< Last Week", "Rota", "Dashboard", new { week = ( Model.ActiveWeekCommenceDate.AddDays(-7).Date ) }, new { @class = "btn btn-primary" })
        @Html.ActionLink("Today", "Rota", "Dashboard", null, new { @class = "btn btn-primary" })
        @Html.ActionLink("Next Week >", "Rota", "Dashboard", new { week = (Model.ActiveWeekCommenceDate.AddDays(7).Date) }, new { @class = "btn btn-primary" })
    </footer>